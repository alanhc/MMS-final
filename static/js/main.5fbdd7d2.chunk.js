(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{216:function(t,e){},264:function(t,e,n){},268:function(t,e){},270:function(t,e){},279:function(t,e){},281:function(t,e){},309:function(t,e){},310:function(t,e){},316:function(t,e){},335:function(t,e){},386:function(t,e){},440:function(t,e,n){"use strict";n.r(e);var r=n(5),a=n.n(r),c=n(239),o=n.n(c),s=(n(264),n(71)),i=n(23),u=n(17),l=n(111),d=n.n(l),j=n(466),f=n(467),b=n(469),p=n(470),O=n(463),h=n(0),g=n(33),v=n(75),x=n(247),m=n(252),y=n(2),w=n(1),k=n(7),A=n(8),L=n(12),I=n(250),S=n.n(I),C=(n(430),n(112)),T=n.n(C),U="atk",R="addr",E={};Object.defineProperty(E,"authToken",{get:function(){return localStorage.getItem(U)},set:function(t){localStorage.setItem(U,t)}}),Object.defineProperty(E,"walletAddress",{get:function(){return T.a.load(R)},set:function(t){T.a.save(R,t,{path:"/"})}}),E.clearAccountData=function(){localStorage.removeItem(U),T.a.remove(R)};var G=E,D=S.a.create({baseURL:"https://alanhc-mms-final.herokuapp.com/"});D.interceptors.request.use((function(t){var e=G.authToken;return t.headers.Authorization=e?"Bearer ".concat(e):"",t}));var B=function(t){Object(k.a)(n,t);var e=Object(A.a)(n);function n(t){var r;for(var a in Object(w.a)(this,n),r=e.call(this),t)r.append(a,t[a]);return r}return Object(y.a)(n)}(Object(L.a)(FormData)),F=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e){return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.get("/login/".concat(e,"/payload")).then((function(t){return t.data.payload}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),N=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e,n){var r;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new B({address:e,signature:n}),t.next=3,D.post("/login",r).then((function(t){return t.data.access_token}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),P=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.get("/renew_token").then((function(t){return t.data.access_token}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e){return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.get("/collections/".concat(e)).then((function(t){return t.data.result}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),q=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e,n){return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.get("/activate_ticket/".concat(e,"/").concat(n),{responseType:"blob"}).then((function(t){return t.data}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Y=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e,n,r){var a;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new B({file:r}),t.next=3,D.post("/qrcode/".concat(e,"/").concat(n),a,{responseType:"blob"}).then((function(t){return t.data}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),M=function(){var t=Object(g.a)(Object(h.a)().mark((function t(e,n,r){var a;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new B({file:r}),t.next=3,D.post("/verify/".concat(e,"/").concat(n),a).then((function(t){return t}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),W=Object(r.createContext)({authState:{isLoggedIn:!1,walletAddres:""},authDispatcher:function(){}}),z=function(t,e){var n,r=e.type,a=e.payload;console.log("Dispatcher state: ",r);var c=null!==(n=null===a||void 0===a?void 0:a.walletAddress)&&void 0!==n?n:"",o=null===a||void 0===a?void 0:a.token;switch(r){case J.AUTO_SYNC:return o?(G.authToken=o,t):t;case J.LOGIN:return G.authToken=o,G.walletAddress=c,{isLoggedIn:!0,walletAddress:c};case J.LOGOUT:return G.clearAccountData(),{isLoggedIn:!1,walletAddress:""};default:return t}},J={AUTO_SYNC:0,LOGIN:1,LOGOUT:2},Q=new v.a("https://mainnet-tezos.giganode.io"),V=new x.a({name:"Mutimedia-Security-Term-Project"});Q.setWalletProvider(V);var H=function(){var t=Object(r.useContext)(W),e=(t.authState,t.authDispatcher),n=Object(r.useState)(""),a=Object(u.a)(n,2),c=a[0],o=a[1],s=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){var n,r,a,c,s;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,V.client.requestPermissions();case 3:return n=t.sent,console.log("Got permissions: ",n.address),r=n.address,o(r),t.next=9,F(n.address);case 9:return a=t.sent,console.log("Got payload: ",a),t.next=13,V.client.requestSignPayload({signingType:m.a.MICHELINE,payload:a});case 13:return c=t.sent,console.log("Got signature: ",c.signature),s=c.signature,t.next=18,N(r,s).then((function(t){console.log("Login Successful!"),console.log(t),e({type:J.LOGIN,payload:{walletAddress:r,token:t}})}));case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(0),o(""),console.log("Got error: ",t.t0);case 24:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}}();return{walletAddress:c,connectWallet:s}},K=n(13),X=function(){var t=H().connectWallet,e=Object(r.useContext)(W),n=e.authState;e.authDispatcher;return Object(K.jsx)(j.a,{sx:{flexGrow:1},children:Object(K.jsx)(f.a,{position:"static",color:"default",enableColorOnDark:!0,children:Object(K.jsxs)(b.a,{children:[Object(K.jsx)(p.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"*"}),null!==n&&void 0!==n&&n.isLoggedIn?Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(O.a,{variant:"outlined",color:"inherit",children:"Synced"})}):Object(K.jsx)(O.a,{variant:"outlined",color:"inherit",onClick:function(){t()},children:"Sync"})]})})})},Z=n(147),$=n(468),tt=n(465),et=n(30),nt=function(){var t=Object(r.useContext)(W),e=t.authState,n=(t.authDispatcher,Object(r.useState)({})),a=Object(u.a)(n,2),c=a[0],o=a[1];Object(r.useEffect)((function(){var t=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){var e;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if([],!G.walletAddress){t.next=6;break}return t.next=4,_(G.walletAddress);case 4:e=t.sent,o(e);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}));var i=Object(et.a)($.a)((function(t){var e=t.theme;return Object(Z.a)(Object(Z.a)({backgroundColor:"dark"===e.palette.mode?"#1A2027":"#fff"},e.typography.body2),{},{padding:e.spacing(1),textAlign:"center",color:e.palette.text.secondary})}));return Object(K.jsx)(j.a,{sx:{flexGrow:1},mt:5,children:null!==e&&void 0!==e&&e.isLoggedIn?Object(K.jsx)(tt.a,{container:!0,spacing:2,justifyContent:"center",children:Object.keys(c).map((function(t){return Object(K.jsx)(i,{children:Object(K.jsxs)(s.b,{to:"/ticket/".concat(c[t].tokenId),children:["NFT TICKET #",c[t].tokenId]})},t)}))}):Object(K.jsx)(K.Fragment,{})})},rt=function(){var t=Object(r.useReducer)(z,{},(function(){var t=G.authToken;if(t&&G.walletAddress){var e,n=(null!==(e=d.a.decode(t))&&void 0!==e?e:{}).address;if(n===G.walletAddress)return{isLoggedIn:!0,walletAddress:n}}return G.clearAccountData(),{isLoggedIn:!1,walletAddress:""}})),e=Object(u.a)(t,2),n=e[0],a=e[1];return Object(r.useEffect)((function(){G.authToken&&G.walletAddress?P().then((function(t){var e;if((null===(e=d.a.decode(t))||void 0===e?void 0:e.address)!==G.walletAddress)throw new Error("Inconsistent address");a({type:J.AUTO_SYNC,payload:{token:t}})})).catch((function(t){a({type:J.LOGOUT}),window.location.reload()})):a({type:J.LOGOUT}),window.scrollTo({top:0,behavior:"smooth"})}),[]),Object(r.useEffect)((function(){function t(t){if(t.key===U)e(t.newValue)}var e=function(t){if(t&&G.walletAddress){var e=d.a.decode(t).address;if(e===G.walletAddress)return void a({type:J.AUTO_SYNC,payload:{walletAddress:e,token:t}})}a({type:J.LOGOUT})};return window.addEventListener("storage",t),function(){window.removeEventListener("storage",t)}}),[]),Object(K.jsxs)(W.Provider,{value:{authState:n,authDispatcher:a},children:[Object(K.jsx)(X,{}),Object(K.jsx)(nt,{})]})},at=function(){var t=Object(i.g)().id,e=Object(r.useContext)(W),n=(e.authState,e.authDispatcher,Object(r.useState)({})),a=Object(u.a)(n,2),c=a[0],o=a[1],s=Object(r.useState)({}),l=Object(u.a)(s,2),d=l[0],f=l[1],b=Object(r.useState)({}),p=Object(u.a)(b,2),v=p[0],x=p[1],m=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){var e,n,r;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Fetching image"),t.next=3,q(d.contract,d.tokenId);case 3:return e=t.sent,localStorage.setItem("imgData",URL.createObjectURL(e)),console.log(localStorage.getItem("imgData")),t.next=8,x(e);case 8:document.getElementById("img").src=URL.createObjectURL(e),n=document.getElementById("activateBtn"),r=document.getElementById("useBtn"),n.style.display="none",r.style.display="block";case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),y=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){var e;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Fetching QR"),t.next=3,Y(d.contract,d.tokenId,v);case 3:e=t.sent,console.log("Got QR"),document.getElementById("qrcode").src=URL.createObjectURL(e);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(Object(h.a)().mark((function e(){var n,r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G.walletAddress){e.next=6;break}return e.next=3,_(G.walletAddress);case 3:for(r in n=e.sent,o(n),c)c[r].tokenId==t&&f(c[r]);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()})),Object(K.jsxs)(j.a,{children:[Object(K.jsx)(X,{}),Object(K.jsx)(j.a,{sx:{width:"100%"},mt:5,display:"flex",align_items:"center",justify:"center",children:Object(K.jsxs)(tt.a,{container:!0,spacing:2,justifyContent:"center",children:[Object(K.jsx)(tt.a,{item:!0,xs:8,children:Object(K.jsx)("img",{id:"img",src:d.thumbnailUri,style:{display:"block",marginLeft:"auto",marginRight:"auto"}})}),Object(K.jsxs)(tt.a,{item:!0,xs:8,justifyContent:"center",children:[Object(K.jsx)(O.a,{id:"activateBtn",variant:"outlined",color:"inherit",onClick:m,style:{display:"block",marginLeft:"auto",marginRight:"auto"},children:"Activate Ticket"}),Object(K.jsx)(O.a,{id:"useBtn",variant:"outlined",color:"inherit",onClick:y,style:{display:"none",marginLeft:"auto",marginRight:"auto"},children:"Use Ticket"})]}),Object(K.jsx)(tt.a,{item:!0,xs:8,children:Object(K.jsx)("img",{id:"qrcode",style:{display:"block",marginLeft:"auto",marginRight:"auto"}})})]})})]})},ct=n(251),ot=function(){var t=Object(i.g)().id,e=Object(r.useState)("No result"),n=Object(u.a)(e,2),a=n[0],c=n[1],o=Object(r.useState)({}),s=Object(u.a)(o,2),l=s[0],d=s[1],f=Object(r.useState)({}),b=Object(u.a)(f,2),p=b[0],v=b[1],x=Object(r.useState)(""),m=Object(u.a)(x,2),y=m[0],w=m[1],k=function(){var t=Object(g.a)(Object(h.a)().mark((function t(){var e;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("verifying"),t.next=3,M(p.contract,p.tokenId,a);case 3:e=t.sent,w(e.data.status);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){var e=function(){var e=Object(g.a)(Object(h.a)().mark((function e(){var n,r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G.walletAddress){e.next=6;break}return e.next=3,_(G.walletAddress);case 3:for(r in n=e.sent,d(n),l)l[r].tokenId==t&&v(l[r]);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()})),Object(K.jsxs)(j.a,{children:[Object(K.jsx)(X,{}),Object(K.jsx)(ct.a,{onResult:function(t,e){t&&(c(null===t||void 0===t?void 0:t.text),w("Scanned."))},style:{height:"10px"}}),Object(K.jsx)(tt.a,{container:!0,spacing:2,justifyContent:"center",children:Object(K.jsx)(tt.a,{item:!0,xs:8,justifyContent:"center",children:Object(K.jsxs)("p",{align:"center",children:[" ",y," "]})})}),Object(K.jsx)(tt.a,{container:!0,spacing:2,justifyContent:"center",children:Object(K.jsx)(tt.a,{item:!0,xs:8,justifyContent:"center",children:Object(K.jsx)(O.a,{id:"activateBtn",variant:"outlined",color:"inherit",onClick:k,style:{display:"block",marginLeft:"auto",marginRight:"auto"},children:"Verify"})})})]})},st=function(){return Object(K.jsx)(s.a,{children:Object(K.jsxs)(i.c,{children:[Object(K.jsx)(i.a,{path:"/",element:Object(K.jsx)(rt,{})}),Object(K.jsx)(i.a,{path:"/ticket/:id",element:Object(K.jsx)(at,{})}),Object(K.jsx)(i.a,{path:"/scan/:id",element:Object(K.jsx)(ot,{})})]})})},it=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,471)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),r(t),a(t),c(t),o(t)}))};o.a.createRoot(document.getElementById("root")).render(Object(K.jsx)(a.a.StrictMode,{children:Object(K.jsx)(st,{})})),it()}},[[440,1,2]]]);
//# sourceMappingURL=main.5fbdd7d2.chunk.js.map