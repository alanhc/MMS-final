(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{216:function(e,t){},264:function(e,t,n){},268:function(e,t){},270:function(e,t){},279:function(e,t){},281:function(e,t){},309:function(e,t){},310:function(e,t){},316:function(e,t){},335:function(e,t){},386:function(e,t){},440:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n.n(r),c=n(239),o=n.n(c),s=(n(264),n(71)),i=n(23),u=n(17),l=n(111),d=n.n(l),j=n(466),f=n(467),b=n(469),p=n(470),O=n(463),h=n(0),v=n(33),g=n(75),x=n(247),m=n(252),y=n(2),w=n(1),k=n(7),L=n(8),A=n(12),I=n(250),S=n.n(I),C=(n(430),n(112)),T=n.n(C),U="atk",R="addr",E={};Object.defineProperty(E,"authToken",{get:function(){return localStorage.getItem(U)},set:function(e){localStorage.setItem(U,e)}}),Object.defineProperty(E,"walletAddress",{get:function(){return T.a.load(R)},set:function(e){T.a.save(R,e,{path:"/"})}}),E.clearAccountData=function(){localStorage.removeItem(U),T.a.remove(R)};var G=E,D=S.a.create({baseURL:"https://alanhc-mms-final.herokuapp.com/"});D.interceptors.request.use((function(e){var t=G.authToken;return e.headers.Authorization=t?"Bearer ".concat(t):"",e}));var B=function(e){Object(k.a)(n,e);var t=Object(L.a)(n);function n(e){var r;for(var a in Object(w.a)(this,n),r=t.call(this),e)r.append(a,e[a]);return r}return Object(y.a)(n)}(Object(A.a)(FormData)),F=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/login/".concat(t,"/payload")).then((function(e){return e.data.payload}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t,n){var r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new B({address:t,signature:n}),e.next=3,D.post("/login",r).then((function(e){return e.data.access_token}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),P=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/renew_token").then((function(e){return e.data.access_token}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/collections/".concat(t)).then((function(e){return e.data.result}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t,n){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/activate_ticket/".concat(t,"/").concat(n),{responseType:"blob"}).then((function(e){return e.data}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t,n,r){var a;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new B({file:r}),e.next=3,D.post("/qrcode/".concat(t,"/").concat(n),a,{responseType:"blob"}).then((function(e){return e.data}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=Object(v.a)(Object(h.a)().mark((function e(t,n,r){var a;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new B({file:r}),e.next=3,D.post("/verify/".concat(t,"/").concat(n),a).then((function(e){return e}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),W=Object(r.createContext)({authState:{isLoggedIn:!1,walletAddres:""},authDispatcher:function(){}}),z=function(e,t){var n,r=t.type,a=t.payload;console.log("Dispatcher state: ",r);var c=null!==(n=null===a||void 0===a?void 0:a.walletAddress)&&void 0!==n?n:"",o=null===a||void 0===a?void 0:a.token;switch(r){case J.AUTO_SYNC:return o?(G.authToken=o,e):e;case J.LOGIN:return G.authToken=o,G.walletAddress=c,{isLoggedIn:!0,walletAddress:c};case J.LOGOUT:return G.clearAccountData(),{isLoggedIn:!1,walletAddress:""};default:return e}},J={AUTO_SYNC:0,LOGIN:1,LOGOUT:2},Q=new g.a("https://mainnet-tezos.giganode.io"),V=new x.a({name:"Mutimedia-Security-Term-Project"});Q.setWalletProvider(V);var H=function(){var e=Object(r.useContext)(W),t=(e.authState,e.authDispatcher),n=Object(r.useState)(""),a=Object(u.a)(n,2),c=a[0],o=a[1],s=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){var n,r,a,c,s;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V.client.requestPermissions();case 3:return n=e.sent,console.log("Got permissions: ",n.address),r=n.address,o(r),e.next=9,F(n.address);case 9:return a=e.sent,console.log("Got payload: ",a),e.next=13,V.client.requestSignPayload({signingType:m.a.MICHELINE,payload:a});case 13:return c=e.sent,console.log("Got signature: ",c.signature),s=c.signature,e.next=18,N(r,s).then((function(e){console.log("Login Successful!"),console.log(e),t({type:J.LOGIN,payload:{walletAddress:r,token:e}})}));case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),o(""),console.log("Got error: ",e.t0);case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}();return{walletAddress:c,connectWallet:s}},K=n(13),X=function(){var e=H().connectWallet,t=Object(r.useContext)(W),n=t.authState;t.authDispatcher;return Object(K.jsx)(j.a,{sx:{flexGrow:1},children:Object(K.jsx)(f.a,{position:"static",color:"default",enableColorOnDark:!0,children:Object(K.jsxs)(b.a,{children:[Object(K.jsx)(p.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"*"}),null!==n&&void 0!==n&&n.isLoggedIn?Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(O.a,{variant:"outlined",color:"inherit",children:"Synced"})}):Object(K.jsx)(O.a,{variant:"outlined",color:"inherit",onClick:function(){e()},children:"Sync"})]})})})},Z=n(147),$=n(468),ee=n(465),te=n(30),ne=function(){var e=Object(r.useContext)(W),t=e.authState,n=(e.authDispatcher,Object(r.useState)({})),a=Object(u.a)(n,2),c=a[0],o=a[1];Object(r.useEffect)((function(){var e=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){var t;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if([],!G.walletAddress){e.next=6;break}return e.next=4,_(G.walletAddress);case 4:t=e.sent,o(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}));var i=Object(te.a)($.a)((function(e){var t=e.theme;return Object(Z.a)(Object(Z.a)({backgroundColor:"dark"===t.palette.mode?"#1A2027":"#fff"},t.typography.body2),{},{padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary})}));return Object(K.jsx)(j.a,{sx:{flexGrow:1},mt:5,children:null!==t&&void 0!==t&&t.isLoggedIn?Object(K.jsx)(ee.a,{container:!0,spacing:2,justifyContent:"center",children:Object.keys(c).map((function(e){return Object(K.jsx)(i,{children:Object(K.jsxs)(s.b,{to:"/ticket/".concat(c[e].tokenId),children:["NFT TICKET #",c[e].tokenId]})},e)}))}):Object(K.jsx)(K.Fragment,{})})},re=function(){var e=Object(r.useReducer)(z,{},(function(){var e=G.authToken;if(e&&G.walletAddress){var t,n=(null!==(t=d.a.decode(e))&&void 0!==t?t:{}).address;if(n===G.walletAddress)return{isLoggedIn:!0,walletAddress:n}}return G.clearAccountData(),{isLoggedIn:!1,walletAddress:""}})),t=Object(u.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){G.authToken&&G.walletAddress?P().then((function(e){var t;if((null===(t=d.a.decode(e))||void 0===t?void 0:t.address)!==G.walletAddress)throw new Error("Inconsistent address");a({type:J.AUTO_SYNC,payload:{token:e}})})).catch((function(e){a({type:J.LOGOUT}),window.location.reload()})):a({type:J.LOGOUT}),window.scrollTo({top:0,behavior:"smooth"})}),[]),Object(r.useEffect)((function(){function e(e){if(e.key===U)t(e.newValue)}var t=function(e){if(e&&G.walletAddress){var t=d.a.decode(e).address;if(t===G.walletAddress)return void a({type:J.AUTO_SYNC,payload:{walletAddress:t,token:e}})}a({type:J.LOGOUT})};return window.addEventListener("storage",e),function(){window.removeEventListener("storage",e)}}),[]),Object(K.jsxs)(W.Provider,{value:{authState:n,authDispatcher:a},children:[Object(K.jsx)(X,{}),Object(K.jsx)(ne,{})]})},ae=function(){var e=Object(i.g)().id,t=Object(r.useContext)(W),n=(t.authState,t.authDispatcher,Object(r.useState)({})),a=Object(u.a)(n,2),c=a[0],o=a[1],s=Object(r.useState)({}),l=Object(u.a)(s,2),d=l[0],f=l[1],b=Object(r.useState)({}),p=Object(u.a)(b,2),g=p[0],x=p[1],m=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){var t,n,r;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching image"),e.next=3,q(d.contract,d.tokenId);case 3:return t=e.sent,localStorage.setItem("imgData",URL.createObjectURL(t)),console.log(localStorage.getItem("imgData")),e.next=8,x(t);case 8:document.getElementById("img").src=URL.createObjectURL(t),n=document.getElementById("activateBtn"),r=document.getElementById("useBtn"),n.style.display="none",r.style.display="block";case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){var t;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching QR"),e.next=3,Y(d.contract,d.tokenId,g);case 3:t=e.sent,console.log("Got QR"),document.getElementById("qrcode").src=URL.createObjectURL(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){var t=function(){var t=Object(v.a)(Object(h.a)().mark((function t(){var n,r;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!G.walletAddress){t.next=6;break}return t.next=3,_(G.walletAddress);case 3:for(r in n=t.sent,o(n),c)c[r].tokenId==e&&f(c[r]);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()})),Object(K.jsxs)(j.a,{children:[Object(K.jsx)(X,{}),Object(K.jsx)(j.a,{sx:{width:"100%"},mt:5,display:"flex",align_items:"center",justify:"center",children:Object(K.jsxs)(ee.a,{container:!0,spacing:2,justifyContent:"center",children:[Object(K.jsx)(ee.a,{item:!0,xs:8,children:Object(K.jsx)("img",{id:"img",src:d.thumbnailUri,style:{display:"block",marginLeft:"auto",marginRight:"auto"}})}),Object(K.jsxs)(ee.a,{item:!0,xs:8,justifyContent:"center",children:[Object(K.jsx)(O.a,{id:"activateBtn",variant:"outlined",color:"inherit",onClick:m,style:{display:"block",marginLeft:"auto",marginRight:"auto"},children:"Activate Ticket"}),Object(K.jsx)(O.a,{id:"useBtn",variant:"outlined",color:"inherit",onClick:y,style:{display:"none",marginLeft:"auto",marginRight:"auto"},children:"Use Ticket"})]}),Object(K.jsx)(ee.a,{item:!0,xs:8,children:Object(K.jsx)("img",{id:"qrcode",style:{display:"block",marginLeft:"auto",marginRight:"auto"}})})]})})]})},ce=n(251),oe=function(){var e=Object(i.g)().id,t=Object(r.useState)("No result"),n=Object(u.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)({}),s=Object(u.a)(o,2),l=s[0],d=s[1],f=Object(r.useState)({}),b=Object(u.a)(f,2),p=b[0],g=b[1],x=Object(r.useState)(""),m=Object(u.a)(x,2),y=m[0],w=m[1],k=function(){var e=Object(v.a)(Object(h.a)().mark((function e(){var t;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("verifying"),e.next=3,M(p.contract,p.tokenId,a);case 3:t=e.sent,w(t.data.status);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){var t=function(){var t=Object(v.a)(Object(h.a)().mark((function t(){var n,r;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!G.walletAddress){t.next=6;break}return t.next=3,_(G.walletAddress);case 3:for(r in n=t.sent,d(n),l)l[r].tokenId==e&&g(l[r]);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()})),Object(K.jsxs)(j.a,{children:[Object(K.jsx)(X,{}),Object(K.jsx)(ce.a,{onResult:function(e,t){e&&(c(null===e||void 0===e?void 0:e.text),w("Scanned."))},style:{height:"10px"}}),Object(K.jsx)(ee.a,{container:!0,spacing:2,justifyContent:"center",children:Object(K.jsx)(ee.a,{item:!0,xs:8,justifyContent:"center",children:Object(K.jsxs)("p",{align:"center",children:[" ",y," "]})})}),Object(K.jsx)(ee.a,{container:!0,spacing:2,justifyContent:"center",children:Object(K.jsx)(ee.a,{item:!0,xs:8,justifyContent:"center",children:Object(K.jsx)(O.a,{id:"activateBtn",variant:"outlined",color:"inherit",onClick:k,style:{display:"block",marginLeft:"auto",marginRight:"auto"},children:"Verify"})})})]})},se=function(){return Object(K.jsx)(s.a,{basename:"{process.env.PUBLIC_URL}",children:Object(K.jsxs)(i.c,{children:[Object(K.jsx)(i.a,{path:"/",element:Object(K.jsx)(re,{})}),Object(K.jsx)(i.a,{path:"/ticket/:id",element:Object(K.jsx)(ae,{})}),Object(K.jsx)(i.a,{path:"/scan/:id",element:Object(K.jsx)(oe,{})})]})})},ie=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,471)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};o.a.createRoot(document.getElementById("root")).render(Object(K.jsx)(a.a.StrictMode,{children:Object(K.jsx)(se,{})})),ie()}},[[440,1,2]]]);
//# sourceMappingURL=main.5b6e5d99.chunk.js.map